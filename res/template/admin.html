{{define "admin_panel"}}
<!DOCTYPE html>
<html>
	<head>
		{{template "meta_tags" "Administrator panel"}}
		{{template "user_style" .}}
		<script type="text/javascript">var apiEndpoint = '{{.APIEndpoint}}';</script>
	</head>
	<body>
		{{$isAdmin := .PixelAPI.UserIsAdmin}}
		<div id="body" class="body" style="max-width: 100%">
			{{template "menu" .}}
			{{if $isAdmin.IsAdmin}}

			<h3>Bandwidth and views</h3>
			<div id="chart_container" class="chart-container" style="position: relative; width: 100%; height: auto;">
				<canvas id="bandwidth_chart"></canvas>
			</div>

			<script src="/res/script/jquery.js"></script>
			<script src="/res/misc/chartjs/Chart.min.js"></script>
			<script>
			$.get(apiEndpoint+"/admin/files/timeseries/14", function(response){
				console.log(response);
				if (response.success) {
					var ctx = document.getElementById('bandwidth_chart');
					Chart.defaults.global.defaultFontColor = "#b3b3b3";
					Chart.defaults.global.defaultFontSize = 16;
					Chart.defaults.global.defaultFontFamily = "Ubuntu";
					new Chart(
						document.getElementById('bandwidth_chart'),
						{
							type: 'line',
							data: {
								labels: response.labels,
								datasets: [
									{
										label: "Bandwidth",
										backgroundColor: "rgba(100, 255, 100, .1)",
										borderColor: "rgba(100, 255, 100, .8)",
										borderWidth: 2,
										fill: true,
										yAxisID: "y_bandwidth",
										data: response.downloads
									}, {
										label: "Views",
										backgroundColor: "rgba(128, 128, 255, .2)",
										borderColor: "rgba(128, 128, 255, .8)",
										borderWidth: 2,
										fill: true,
										yAxisID: "y_views",
										data: response.views
									}
								]
							},
							options: {
								stacked: false,
								aspectRatio: 3,
								tooltips: {
									mode: "index",
									intersect: false,
									axis: "x"
								},
								scales: {
									yAxes: [
										{
											type: "linear",
											display: true,
											position: "left",
											id: "y_bandwidth",
											scaleLabel: {
												display: true,
												labelString: "Bandwidth"
											},
											ticks: {
												callback: function(value, index, values) {
													return (value/1e9) + " GB";
												}
											},
											gridLines: {
												color: "rgba(100, 255, 100, .1)"
											}
										}, {
											type: "linear",
											display: true,
											position: "right",
											id: "y_views",
											scaleLabel: {
												display: true,
												labelString: "Views"
											},
											gridLines: {
												color: "rgba(128, 128, 255, .2)"
											}
										}
									],
									xAxes: [
										{
											gridLines: {
												display: false
											}
										}
									]
								},
								elements: {
									point: {
										radius: 0
									}
								}
							}
						}
					);
				}
			});
			</script>

			{{else}}
			<h1 style="text-align: center;">;)</h1>
			{{end}}
			{{template "footer"}}
		</div>
	</body>
</html>
{{end}}
