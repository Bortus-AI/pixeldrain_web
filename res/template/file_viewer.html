{{define "file_viewer"}}
<!DOCTYPE html>
<html lang="en">
	<head>
		<title>{{.Title}}</title>
		<meta charset="UTF-8"/>
		<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
		{{template "user_style" .}}
		<link rel="shortcut icon" href="/res/img/tray32.png"/>
		<link rel="icon" sizes="180x180" href="/res/img/pixeldrain.png"/>
		<link rel="icon" sizes="256x256" href="/res/img/pixeldrain_big.png"/>
		<meta name="theme-color" content="#75AD38"/>

		<style>
		{{template `viewer.css`}}
		{{template `modal.css`}}
		</style>

		{{.OGData}}
	</head>

	<body>
		<div id="file_viewer" class="file_viewer">
			<div id="file_viewer_headerbar" class="highlight_1 file_viewer_headerbar">
				<button id="btn_toggle_toolbar" class="button_toggle_toolbar"><i class="icon small">menu</i></button>
				<a href="/" id="button_home" class="button button_home">
					{{template `pixeldrain.svg` .}}
				</a>
				<div id="file_viewer_headerbar_title" class="file_viewer_headerbar_title">
					<div id="file_viewer_list_title"></div>
					<div id="file_viewer_file_title">{{.Title}}</div>
				</div>
			</div>
			<div id="list_navigator" class="list_navigator"></div>
			<div id="file_viewer_window" class="file_viewer_window">
				<div id="toolbar" class="file_viewer_toolbar"><div><div>
					<div id="stat_views_label" class="toolbar_label">Views</div>
					<div id="stat_views" style="text-align: center;">N/A</div>
					<div id="stat_downloads_label" class="toolbar_label">Downloads</div>
					<div id="stat_downloads" style="text-align: center;">N/A</div>
					<div id="stat_size_label" class="toolbar_label">Size</div>
					<div id="stat_size" style="text-align: center;">N/A</div>

					<button id="btn_download" class="toolbar_button button_full_width">
						<i class="icon">save</i>
						<span>Download</span>
					</button>
					<button id="btn_download_list" class="toolbar_button button_full_width" style="display: none;">
						<i class="icon">save</i>
						<span>DL all files</span>
					</button>
					<button id="btn_copy" class="toolbar_button button_full_width">
						<i class="icon">content_copy</i>
						<span><u>C</u>opy Link</span>
					</button>
					<button id="btn_share" class="toolbar_button button_full_width">
						<i class="icon">share</i>
						<span>Share</span>
					</button>
					<button id="btn_shuffle" class="toolbar_button button_full_width" style="display: none;">
						<i class="icon">shuffle</i>
						<span>Shuffle &#x2610;</span>
					</button>
					<button id="btn_details" class="toolbar_button button_full_width">
						<i class="icon">help</i>
						<span>Deta<u>i</u>ls</span>
					</button>
					<button id="btn_edit" class="toolbar_button button_full_width" style="display: none;">
						<i class="icon">edit</i>
						<span><u>E</u>dit</span>
					</button>
					<br/>

					{{if .Other.ShowAds}}
					<hr/>
					<!-- <div id="brave_ref" style="text-align: center; padding: 2px;"> -->
						{{if ne (isBrave .UserAgent) true}}
						Use the Brave web browser for a faster and safer web!<br/>
						<a href="https://brave.com/pix009" id="btnBrave" class="button toolbar_button button_full_width button_highlight">
							<img src="{{template `brave_lion.png`}}" alt="Brave lion"/>
							<span>Get Brave</span>
						</a>
						<br/>
						or <a href="https://medium.com/pixeldrain/advertising-on-pixeldrain-a-more-honest-approach-d5e00e3f0c29">learn why pixeldrain supports Brave</a>
						{{else}}
						Thank you for using Brave! Please consider supporting pixeldrain with a tip
						<img src="{{template `bat_logo_color.png`}}" style="height: 1em; width: 1em;" />
						{{end}}
					<!-- </div> -->
					<br/>
					{{end}}

					<!-- This frame will load the download URL when a download button is pressed -->
					<iframe id="download_frame" style="display: none; width: 1px; height: 1px;"></iframe>
				</div></div></div>

				<div id="sharebar" class="file_viewer_sharebar">
					Share on:<br/>
					<button class="sharebar-button button_full_width" onclick="window.open('mailto:please@set.address?subject=File%20on%20pixeldrain&body=' + window.location.href);">
						{{template `email.svg` .}}<br/>E-Mail
					</button>
					<button class="sharebar-button button_full_width" onclick="window.open('https://www.reddit.com/submit?url=' + window.location.href);">
						{{template `reddit.svg` .}}<br/>Reddit
					</button>
					<button class="sharebar-button button_full_width" onclick="window.open('https://twitter.com/share?url=' + window.location.href);">
						{{template `twitter.svg` .}}<br/>Twitter
					</button>
					<button class="sharebar-button button_full_width" onclick="window.open('http://www.facebook.com/sharer.php?u=' + window.location.href);">
						{{template `facebook.svg` .}}<br/>Facebook
					</button>
					<button class="sharebar-button button_full_width" onclick="window.open('http://www.tumblr.com/share/link?url=' + window.location.href);">
						{{template `tumblr.svg` .}}<br/>Tumblr
					</button>
				</div>

				<div id="filepreview" class="file_viewer_file_preview">
					<div class="center" style="width: 100px; height: 100px;">{{template "spinner.svg" .}}</div>
				</div>
			</div>

			{{if .Other.ShowAds}}
			<div id="sponsors" class="sponsors">
				{{if eq .Other.AdType 0}}
				<!-- scrolling="no" is not allowed by the W3C, but overflow: hidden doesn't work in chrome, so I have no choice -->
				<iframe class="sponsors_banner"
					data-aa="73974"
					src="//ad.a-ads.com/73974?size=728x90&background_color={{.Style.Layer1Color.RGB}}&text_color={{.Style.TextColor.RGB}}&title_color={{.Style.HighlightColor.RGB}}&title_hover_color={{.Style.HighlightColor.RGB}}&link_color={{.Style.HighlightColor.RGB}}&link_hover_color={{.Style.HighlightColor.RGB}}"
					style="width:728px; height:90px; border:none; padding:0; overflow:hidden;"
					scrolling="no">
				</iframe>
				{{else if eq .Other.AdType 1}}
				<a class="sponsors_banner" style="display: inline-block; width: 576px; height: 96px;" href="/click/DtZ3hHT9?target=https%3A%2F%2Fwww.amarula-electronics.com/?v=79cba1185463">
					<img src="/res/img/misc/banner_as.png" style="width: 100%; height: 100%" />
				</a>
				{{else if eq .Other.AdType 2}}
				<div style="text-align: center; line-height: 22px; font-size: 18px;">
					<div style="margin: 4px 8px; display: inline-block; vertical-align: middle;">
						Pixeldrain needs money to survive!<br/>
						<a href="https://www.patreon.com/pixeldrain" class="button button_highlight">
							Support me on Patreon and get some neat perks
						</a>
					</div>
					<div style="margin: 4px 8px; display: inline-block; vertical-align: middle; text-align: left;">
						No ads when viewing files<br/>
						No ads on your uploaded files<br/>
						Longer file retention<br/>
					</div>
				<div>

				{{end}}
			</div>
			{{end}}
		</div>

		<template id="tpl_details_popup">
			<table class="info_file_details" style="min-width: 100%;"></table>

			<div class="info_about">
				<h3>Downloads and views</h3>
				<div class="chart-container" style="position: relative; width: 100%; height: 250px;">
					<canvas id="bandwidth_chart"></canvas>
				</div>
				<p style="text-align: center">
					Chart rendered by the amazing <a href="https://www.chartjs.org/" target="_blank">Chart.js</a>.
				</p>

				<h3>About</h3>
				Pixeldrain is a file sharing platform.
				<a href="/" target="_blank">Visit the home page for more information.</a>

				<h3>Keyboard Controls</h3>
				<table style="max-width: 100%;">
					<tr><td colspan="2">File Shortcuts</td></tr>
					<tr><td>c</td><td> = Copy URL of this page</td></tr>
					<tr><td>i</td><td> = Toggle details window (this window) (<b><u>i</u></b>nfo)</td></tr>
					<tr><td>s</td><td> = Download the file you are currently viewing (<b><u>s</u></b>ave)</td></tr>
					<tr><td>q</td><td> = Close the window (<b><u>q</u></b>uit)</td></tr>
					<tr><td colspan="2">List Shortcuts</td></tr>
					<tr><td>a or &#8592;</td><td> = View previous item in list</td></tr>
					<tr><td>d or &#8594;</td><td> = View next item in list</td></tr>
					<tr><td>r</td><td> = Toggle shuffle (<b><u>r</u></b>andom)</td></tr>
					<tr><td>SHIFT + s</td><td> = Download all the files in the list as a zip archive</td></tr>
				</table>
			</div>
		</template>

		<template id="tpl_edit_file">
			<h3>Delete file</h3>
			<p>
				When you delete a file it cannot be recovered.
				Nobody will be able to download it and the link will
				stop working. The file will also disappear from any
				lists it's contained in.
			</p>
			<div style="text-align: center;">
				<button class="button_red btn_delete_file">
					<i class="icon small">delete</i> Delete this file
				</button>
			</div>
		</template>

		<template id="tpl_captcha_popup">
			<div class="captcha_text"></div>
			<br/>
			<div class="captcha_popup_captcha" style="text-align: center;"></div>
		</template>

		<script src="/res/script/Chart.min.js"></script>
		<script>
			'use strict';
			let apiEndpoint = '{{.APIEndpoint}}';
			let captchaKey = '{{.Other.CaptchaKey}}';

			{{template `util.js`}}
			{{template `Modal.js`}}
			{{template `Toolbar.js`}}
			{{template `EditWindow.js`}}
			{{template `DetailsWindow.js`}}
			{{template `ListNavigator.js`}}
			{{template `Viewer.js`}}

			{{template `ImageViewer.js`}}
			{{template `VideoViewer.js`}}
			{{template `AudioViewer.js`}}
			{{template `PDFViewer.js`}}
			{{template `TextViewer.js`}}
			{{template `FileViewer.js`}}

			// This info gets filled in on the server side to prevent having to make an API call right after the page loads.
			// Just to slice another few milliseconds from the load time :)
			window.addEventListener("load", function(){
				new Viewer('{{.Other.Type}}', '{{.Other.ViewToken}}', {{.Other.APIResponse}});
			});
		</script>

		{{template "analytics"}}
	</body>
</html>
{{end}}
