<script>
import { onMount, tick } from "svelte";
import Modal from "../util/Modal.svelte";

let modal

const close = () => {
	localStorage.setItem("ukraine_modal_dismissed", "üá∫üá¶")
	modal.hide()
}
onMount(async () => {
	if (localStorage.getItem("ukraine_modal_dismissed") === "üá∫üá¶") {
		return
	}

	let country = localStorage.getItem("country_code")
	if (country === null) {
		try {
			const resp = await fetch(window.api_endpoint+"/misc/geo_ip")
			if(resp.status >= 400) {
				throw new Error(await resp.text())
			}
			country = (await resp.json()).country.iso_code;
			localStorage.setItem("country_code", country)
		} catch (err) {
			console.log("Failed to get geo IP data: ", err)
			return
		}
	}

	if (country === "RU" || country === "BY") {
		modal.show()
		await tick()
		resize()
	}
})

let video
const resize = () => {
	video.style.height = (video.clientWidth*0.56)+"px"
}

let language = "RU"
</script>

<svelte:window on:resize={resize} />

<Modal bind:this={modal} title="Vladimir Putin is lying to you!" width="1000px">
	<iframe bind:this={video}
		style="width: 100%; height: 562px;"
		src="https://www.youtube-nocookie.com/embed/Y0IobS_JDww?start=1996"
		title="YouTube video player"
		frameborder="0"
		allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
		allowfullscreen
	>
	</iframe>
	<br/>

	{#if language === "EN"}
		<div style="text-align: center; font-size: 1.4em;">
			<a href="https://www.youtube.com/watch?v=Y0IobS_JDww&t=1996s" class="button" target="_blank">
				<i class="icon">play_circle</i>
				Watch on YouTube
			</a>
			<a href="https://pixeldrain.com/u/JZ9D7RFC" class="button" target="_blank">
				<i class="icon">play_circle</i>
				Watch on Pixeldrain
			</a>
		</div>
		<div class="indent">
			<p>
				An independent news agency asked me to show this video to my
				Russian visitors. The goal is to prevent the spread of
				misinformation. Russian news agencies are spreading propaganda,
				they cannot be trusted.
			</p>
			<p>
				Ukraine is not governed by nazis. The Ukrainian parliament and
				president were democratically elected. It is a peaceful nation.
			</p>
			<p>
				The Russian army is bombing cities and committing genocide
				across the country. Thousands of civilians have been brutally
				murdered. This has to stop as soon as possible.
			</p>
		</div>
	{:else if language === "RU"}
		<div style="text-align: center; font-size: 1.4em;">
			<a href="https://www.youtube.com/watch?v=Y0IobS_JDww&t=1996s" class="button" target="_blank">
				<i class="icon">play_circle</i>
				–°–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ YouTube
			</a>
			<a href="https://pixeldrain.com/u/JZ9D7RFC" class="button" target="_blank">
				<i class="icon">play_circle</i>
				–°–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ Pixeldrain
			</a>
		</div>
		<div class="indent">
			<p>
				–ù–µ–∑–∞–≤–∏—Å–∏–º–æ–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ –∞–≥–µ–Ω—Ç—Å—Ç–≤–æ –ø–æ–ø—Ä–æ—Å–∏–ª–æ –º–µ–Ω—è –ø–æ–∫–∞–∑–∞—Ç—å —ç—Ç–æ
				–≤–∏–¥–µ–æ –º–æ–∏–º —Ä–æ—Å—Å–∏–π—Å–∫–∏–º –ø–æ—Å–µ—Ç–∏—Ç–µ–ª—è–º. –¶–µ–ª—å —Å–æ—Å—Ç–æ–∏—Ç –≤ —Ç–æ–º, —á—Ç–æ–±—ã
				–ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –¥–µ–∑–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏. –†–æ—Å—Å–∏–π—Å–∫–∏–µ
				–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ –∞–≥–µ–Ω—Ç—Å—Ç–≤–∞ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è—é—Ç –ø—Ä–æ–ø–∞–≥–∞–Ω–¥—É, –∏–º –Ω–µ–ª—å–∑—è
				–¥–æ–≤–µ—Ä—è—Ç—å.
			</p>
			<p>
				–£–∫—Ä–∞–∏–Ω–∞ –Ω–µ —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞—Ü–∏—Å—Ç–∞–º–∏. –£–∫—Ä–∞–∏–Ω—Å–∫–∏–π –ø–∞—Ä–ª–∞–º–µ–Ω—Ç –∏
				–ø—Ä–µ–∑–∏–¥–µ–Ω—Ç –±—ã–ª–∏ –∏–∑–±—Ä–∞–Ω—ã –¥–µ–º–æ–∫—Ä–∞—Ç–∏—á–µ—Å–∫–∏–º –ø—É—Ç–µ–º. –≠—Ç–æ –º–∏—Ä–æ–ª—é–±–∏–≤–∞—è
				–Ω–∞—Ü–∏—è.
			</p>
			<p>
				–†–æ—Å—Å–∏–π—Å–∫–∞—è –∞—Ä–º–∏—è –±–æ–º–±–∏—Ç –≥–æ—Ä–æ–¥–∞ –∏ —Å–æ–≤–µ—Ä—à–∞–µ—Ç –≥–µ–Ω–æ—Ü–∏–¥ —á–µ—Ä–µ–∑ –≤—Å—é
				—Å—Ç—Ä–∞–Ω—É. –¢—ã—Å—è—á–∏ –º–∏—Ä–Ω—ã—Ö –∂–∏—Ç–µ–ª–µ–π –±—ã–ª–∏ –∑–≤–µ—Ä—Å–∫–∏ —É–±–∏—Ç—ã. –≠—Ç–æ –¥–æ–ª–∂–Ω–æ
				–ø—Ä–µ–∫—Ä–∞—Ç–∏—Ç—å—Å—è –∫–∞–∫ –º–æ–∂–Ω–æ —Å–∫–æ—Ä–µ–µ.
			</p>
		</div>
	{/if}

	<button on:click={() => language = "RU"} class:button_highlight={language === "RU"} style="float: left; margin: 8px; margin-right: 0;">
		<i class="icon">translate</i> RU
	</button>
	<button on:click={() => language = "EN"} class:button_highlight={language === "EN"} style="float: left; margin: 8px;">
		<i class="icon">translate</i> EN
	</button>

	<button style="float: right; margin: 8px;" on:click={close}>
		<i class="icon">close</i>
		{#if language === "EN"}
			Don't show this again
		{:else if language === "RU"}
			–ù–µ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —ç—Ç–æ —Å–Ω–æ–≤–∞
		{/if}
	</button>
</Modal>
